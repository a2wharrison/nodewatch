#!/usr/bin/env python

import socket
import imp
mk = imp.load_source('mk', 'build/scripts/mk')

from argparse import ArgumentParser, RawDescriptionHelpFormatter

DESC="""
Configures this package to adapt to many kinds of systems.\n
To assign environment variables (e.g., CC, CFLAGS...), specify them as
VAR=VALUE.  See below for descriptions of some of the useful variables.\n
"""

EPILOGUE="""
The ERL_LIBS environment variable needs to include this (top level) directory
if you're planning to use the generated Makefile(s) to compile/build this
software. Use the supplied `setenv.sh' script in this case.
"""

HOST_HELPSTRING="""
The fully qualified host name of the target (for install) machine.\n
NB: this doesn't have to be the name of the host on which you're
building and/or configuring the sources.
"""

def configure(opts, args):
    output = mk.Writer(opts)
    output.show_stage('CONFIGURE', 'Generate Makefile(s)')
    if opts.localdeps:
        lcl = '-l'
    else: 
        lcl = ''
    mk.template('Makefile.in', 'Makefile', dict(local=lcl))


if __name__ == '__main__':
    parser = mk.default_options(description=DESC,
                                epilog=EPILOGUE,
                                usage=mk.USAGE,
                                version='configure v%s' % mk.VSN)
    parser.add_option('--prefix',
                      default='/opt/nodewatch',
                      help='install architecture-independent files in PREFIX')
    parser.add_option('-n', '--hostname',
                      default=socket.getfqdn(),
                      help=HOST_HELPSTRING)

    configure(*parser.parse_args())
